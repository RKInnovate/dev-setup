# File: versions.lock
# Purpose: Version lock file for all non-Homebrew dependencies (git repos, custom installers)
# Problem: Git repos and custom tools need version pinning but aren't managed by Homebrew
# Role: Single source of truth for versions of git-cloned repos and script-installed tools
# Usage: Read by devsetup verify to check installed versions match expected versions
# Design choices: TOML format for readability; commit SHAs preferred over tags for immutability
# Assumptions: Used in conjunction with Brewfile.lock.json for complete version lock

[metadata]
schema_version = "1.0"
platform = "darwin"  # macOS only
min_macos_version = "12.0"  # macOS Monterey or later
updated = 2025-12-22T00:00:00Z

# ===================================================================
# Homebrew Configuration
# ===================================================================
# Note: Actual versions are in Brewfile.lock.json (generated by brew bundle)
# This section is for reference and validation only

[homebrew]
  [homebrew.formulas]
  # Stage 1: Critical
  git = { version = "2.43.0", tap = "homebrew/core" }
  node = { version = "20.10.0", tap = "homebrew/core" }
  pnpm = { version = "8.10.5", tap = "homebrew/core" }

  # Stage 2: Full stack
  git-lfs = { version = "3.4.0", tap = "homebrew/core" }
  wget = { version = "1.21.4", tap = "homebrew/core" }
  starship = { version = "1.17.1", tap = "homebrew/core" }
  jq = { version = "1.7.1", tap = "homebrew/core" }
  ripgrep = { version = "14.0.3", tap = "homebrew/core" }
  fd = { version = "9.0.0", tap = "homebrew/core" }
  bat = { version = "0.24.0", tap = "homebrew/core" }
  eza = { version = "0.17.0", tap = "homebrew/core" }

  # Stage 3: Optional
  fzf = { version = "0.44.1", tap = "homebrew/core" }
  tree = { version = "2.1.1", tap = "homebrew/core" }
  htop = { version = "3.3.0", tap = "homebrew/core" }
  tldr = { version = "3.2.0", tap = "homebrew/core" }

  [homebrew.casks]
  zed = { version = "0.118.0", tap = "homebrew/cask" }
  "font-hack-nerd-font" = { version = "3.1.1", tap = "homebrew/cask-fonts" }
  docker = { version = "4.26.1", tap = "homebrew/cask" }

# ===================================================================
# Non-Homebrew Tools
# ===================================================================

[tools]
  [tools.uv]
  version = "0.1.12"
  installer = "https://astral.sh/uv/install.sh"
  verify_command = "uv --version"

# ===================================================================
# Git Repositories (cloned to ~/.local/share/dev-setup/)
# ===================================================================

[git_repos]
  [git_repos.flutter-wrapper]
  url = "https://github.com/BadRat-in/flutter-wrapper"
  commit = "main"  # TODO: Replace with actual commit SHA after first install
  path = "~/.local/share/dev-setup/flutter-wrapper"
  shallow = true
  stage = 2
  symlink = { from = "bin/flutter", to = "~/.local/bin/flutterw" }

  [git_repos.git-config]
  url = "https://github.com/BadRat-in/git-config"
  commit = "main"  # TODO: Replace with actual commit SHA after first install
  path = "~/.local/share/dev-setup/git-config"
  shallow = true
  stage = 2

  # Zsh plugins
  [git_repos.zsh-completions]
  url = "https://github.com/zsh-users/zsh-completions"
  tag = "0.35.0"
  path = "~/.local/share/dev-setup/zsh-plugins/zsh-completions"
  shallow = true
  stage = 2

  [git_repos.zsh-syntax-highlighting]
  url = "https://github.com/zsh-users/zsh-syntax-highlighting"
  tag = "0.8.0"
  path = "~/.local/share/dev-setup/zsh-plugins/zsh-syntax-highlighting"
  shallow = true
  stage = 2

  [git_repos.zsh-autosuggestions]
  url = "https://github.com/zsh-users/zsh-autosuggestions"
  tag = "0.7.0"
  path = "~/.local/share/dev-setup/zsh-plugins/zsh-autosuggestions"
  shallow = true
  stage = 2

  [git_repos.zsh-history-substring-search]
  url = "https://github.com/zsh-users/zsh-history-substring-search"
  tag = "1.1.0"
  path = "~/.local/share/dev-setup/zsh-plugins/zsh-history-substring-search"
  shallow = true
  stage = 2

# ===================================================================
# Shell Configuration
# ===================================================================

[shell]
default = "zsh"
profile_path = "~/.zprofile"
rc_path = "~/.zshrc"

# ===================================================================
# Usage Notes
# ===================================================================
#
# 1. Updating versions:
#    - For Homebrew packages: `brew bundle dump --force` (updates Brewfile.lock.json)
#    - For git repos: Use `devsetup update --capture-versions` (updates this file)
#
# 2. Verifying environment:
#    - Run `devsetup verify` to check all versions match
#    - Use `devsetup verify --fix` to automatically fix mismatches
#
# 3. Version format:
#    - Homebrew: Uses versions from Brewfile.lock.json
#    - Git repos: Prefer commit SHAs over tags for immutability
#    - Tags are acceptable for stable releases
#
# 4. Commit this file to git!
#    - Ensures all developers get identical versions
#    - Required for "zero works-on-my-machine issues"
